

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Documentation &mdash; Texthon</title>
    
    <link rel="stylesheet" href="_static/haiku_custom.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.7',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/theme_extras.js"></script>
    <link rel="top" title="Texthon" href="index.html" />
    <link rel="next" title="Python API" href="api.html" />
    <link rel="prev" title="Introduction" href="index.html" /> 
  </head>
  <body>
      <div class="header">
	<a id="forkme_banner" href="https://github.com/kevinic">Follow on GitHub</a>
	<h1 class="heading"><a href="index.html">
	<span>Texthon</span></a></h1>
	<h2 class="heading"><span>Half Text, Half Python</span></h2>


      </div>
      <div class="topnav">
      
        <p>
        «&#160;&#160;<a href="index.html">Introduction</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="api.html">Python API</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="documentation">
<h1><a class="toc-backref" href="#id3">Documentation</a><a class="headerlink" href="#documentation" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#documentation" id="id3">Documentation</a><ul>
<li><a class="reference internal" href="#overview" id="id4">Overview</a></li>
<li><a class="reference internal" href="#command-line-script" id="id5">Command Line Script</a></li>
<li><a class="reference internal" href="#samples" id="id6">Samples</a></li>
<li><a class="reference internal" href="#directives" id="id7">Directives</a><ul>
<li><a class="reference internal" href="#comment" id="id8">Comment</a></li>
<li><a class="reference internal" href="#import" id="id9">Import</a></li>
<li><a class="reference internal" href="#load" id="id10">Load</a></li>
<li><a class="reference internal" href="#attribute" id="id11">Attribute</a></li>
<li><a class="reference internal" href="#template-function" id="id12">Template Function</a></li>
<li><a class="reference internal" href="#single-statement" id="id13">Single Statement</a></li>
<li><a class="reference internal" href="#compound-statement" id="id14">Compound Statement</a></li>
</ul>
</li>
<li><a class="reference internal" href="#text-line" id="id15">Text Line</a><ul>
<li><a class="reference internal" href="#identifier-placeholder" id="id16">Identifier Placeholder</a></li>
<li><a class="reference internal" href="#expression-placeholder" id="id17">Expression Placeholder</a></li>
<li><a class="reference internal" href="#slurp-placeholder" id="id18">Slurp Placeholder</a></li>
</ul>
</li>
<li><a class="reference internal" href="#template-execution" id="id19">Template Execution</a></li>
<li><a class="reference internal" href="#template-modules" id="id20">Template Modules</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id4">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Texthon compiles a template file into a template module.  Each template
module contains one or more template functions.</p>
<p>During the parsing stage, a template file is processed line by line, where each
line may be a directive or text.  Text lines may contain placeholders that will
be replaced by evaluated Python expressions.</p>
<p>Once compiled, a template function may be called with corresponding parameters.
The result of the call is a Python string.</p>
<p>This snippet demonstrates all the stages:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">texthon</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">texthon</span><span class="o">.</span><span class="n">Engine</span><span class="p">()</span>

<span class="c"># parse and store the parsed module</span>
<span class="n">module</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">load_file</span><span class="p">(</span><span class="s">&quot;template.txt&quot;</span><span class="p">)</span>

<span class="c"># Store the path so we can find the compiled module later.</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">path</span>

<span class="c"># compile all modules</span>
<span class="n">engine</span><span class="o">.</span><span class="n">make</span><span class="p">()</span>

<span class="c"># call the template function named &#39;main&#39;</span>
<span class="k">print</span><span class="p">(</span><span class="n">engine</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">path</span><span class="p">]</span><span class="o">.</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="command-line-script">
<span id="cmd-script"></span><h2><a class="toc-backref" href="#id5">Command Line Script</a><a class="headerlink" href="#command-line-script" title="Permalink to this headline">¶</a></h2>
<p>A command line script is available to evaluate template files without having
to write your own Python code.</p>
<p>Invoke <tt class="docutils literal"><span class="pre">texthon</span> <span class="pre">--help</span></tt> for documentation on the script parameters.</p>
</div>
<div class="section" id="samples">
<span id="test-samples"></span><h2><a class="toc-backref" href="#id6">Samples</a><a class="headerlink" href="#samples" title="Permalink to this headline">¶</a></h2>
<p>The tests directory contains sample templates.  They are:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="http://todo">helloworld</a> - a minimal example</li>
<li><a class="reference external" href="http://todo">basic</a> - shows basic directive use and template module loads</li>
<li><a class="reference external" href="http://todo">html</a> - shows the use of template mixins and parser parameters</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="directives">
<h2><a class="toc-backref" href="#id7">Directives</a><a class="headerlink" href="#directives" title="Permalink to this headline">¶</a></h2>
<pre>
<strong id="grammar-token-directive">directive  </strong> ::=  dir_prefix dir_command dir_statement
<strong id="grammar-token-dir_command">dir_command</strong> ::=  &quot;`* &lt;comment_directive&gt;`&quot; | &quot;!&quot; | &quot;{&quot; | &quot;}&quot; | dir_keyword
<strong id="grammar-token-dir_keyword">dir_keyword</strong> ::=  &quot;load&quot; | &quot;import&quot; | &quot;attribute&quot; | &quot;template&quot; | &quot;end&quot;
</pre>
<p>Directives are Texthon control commands and do not affect the output text
directly. A directive is issued on its own line, beginning with the directive
prefix token. The rest of the documentation assumes &#8216;#&#8217; is the prefix.</p>
<p>Prepend &#8216;&#8217; to escape the token.  Escapes are only processed at the beginning
of the line.</p>
<p>Directives operate either in the module scope or the function scope.  Only
function scope directives should be issued between #template and #end template
lines.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>There may be arbitrary amount of whitespace between the prefix and the command.
In addition, the parser allows for extra characters after the directive for
most of the commands, so you can do:</p>
<div class="highlight-none"><div class="highlight"><pre>&lt;!--# template name --&gt;
</pre></div>
</div>
<p>In the example above, the prefix is &#8220;&lt;!&#8211;#&#8221;, and anything after &#8220;name&#8221; is
ignored, so you can close out the line with an xml comment end.</p>
<p>Since the parser does not handle execution statements itself, remember to add a
&#8216;#&#8217; if you want to do the same trick:</p>
<div class="last highlight-none"><div class="highlight"><pre>&lt;!--#! print(&quot;foo&quot;) #--&gt;
</pre></div>
</div>
</div>
<div class="section" id="comment">
<span id="comment-directive"></span><h3><a class="toc-backref" href="#id8">Comment</a><a class="headerlink" href="#comment" title="Permalink to this headline">¶</a></h3>
<p>Module and function scope:</p>
<div class="highlight-none"><div class="highlight"><pre>#* &lt;comment&gt;
</pre></div>
</div>
<p>Comments are ignored at the module scope, and emitted as Python #
comments at the function scope to aid debugging.</p>
<p>Example:</p>
<div class="highlight-none"><div class="highlight"><pre>#* just a comment left by the author
</pre></div>
</div>
</div>
<div class="section" id="import">
<span id="import-directive"></span><h3><a class="toc-backref" href="#id9">Import</a><a class="headerlink" href="#import" title="Permalink to this headline">¶</a></h3>
<p>Module scope:</p>
<div class="highlight-none"><div class="highlight"><pre>#import &lt;module&gt; as &lt;alias&gt;
</pre></div>
</div>
<p>Import a Python module under &lt;alias&gt;.  The alias is required.  Once imported,
the alias will be available for all definitions in the module.</p>
<p>Example:</p>
<div class="highlight-none"><div class="highlight"><pre>#import string as str
#import os.path as path
</pre></div>
</div>
</div>
<div class="section" id="load">
<span id="load-directive"></span><h3><a class="toc-backref" href="#id10">Load</a><a class="headerlink" href="#load" title="Permalink to this headline">¶</a></h3>
<p>Module scope:</p>
<div class="highlight-none"><div class="highlight"><pre>#load &lt;path&gt; as &lt;alias&gt; [(attributes)]
</pre></div>
</div>
<p>Load another template module in the file specified by &lt;alias&gt;.  &lt;path&gt; is
resolved relative to the directory of the current file and the list of
include paths added by <tt class="docutils literal"><span class="pre">engine.add_includes</span></tt>.</p>
<p>The attributes indicate how the parser will load and process the file.  The
following attributes are available:</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">abs</span></tt> - do not use the path of the current file to resolve &lt;path&gt;.  Off
by default.</li>
<li><tt class="docutils literal"><span class="pre">directive_token</span> <span class="pre">=</span> <span class="pre">&lt;token&gt;</span></tt> - load the file with &lt;token&gt; as the
directive token.  Same as the current file by default.</li>
<li><tt class="docutils literal"><span class="pre">placeholder</span> <span class="pre">=</span> <span class="pre">&lt;char&gt;</span></tt> - use &lt;char&gt; as the character prefix for
placeholders.  Same as the current file by default.</li>
</ul>
</div></blockquote>
<p>Example:</p>
<div class="highlight-none"><div class="highlight"><pre>#load &quot;lib/file.tmpl&quot; as lib
#load &quot;lib/file.tmpl.html&quot; as html_lib (directive_token = &lt;!--)
#load &quot;lib/file.tmpl&quot; as lib (abs)
</pre></div>
</div>
</div>
<div class="section" id="attribute">
<span id="attribute-directive"></span><h3><a class="toc-backref" href="#id11">Attribute</a><a class="headerlink" href="#attribute" title="Permalink to this headline">¶</a></h3>
<p>Module scope:</p>
<div class="highlight-none"><div class="highlight"><pre>#attribute &lt;name&gt; &lt;expression&gt;
</pre></div>
</div>
<p>Declare a module level variable &lt;name&gt; and assign the result of &lt;expression&gt;.</p>
<p>Within the same module, an attribute can be read by a template function without
any qualification. To assign a new value, however, you must go through the
builtin variable <tt class="docutils literal"><span class="pre">_module</span></tt>:</p>
<div class="highlight-none"><div class="highlight"><pre>#! temp_name = name # ok, if name has been defined as an attribute
#! _module.name = &quot;new name&quot; # assignment requires _module access
</pre></div>
</div>
<p><a class="reference internal" href="#template-execution"><em>More details</em></a>.</p>
<p>Example:</p>
<div class="highlight-none"><div class="highlight"><pre>#attribute author = &quot;anonymous&quot;
</pre></div>
</div>
</div>
<div class="section" id="template-function">
<span id="template-directive"></span><h3><a class="toc-backref" href="#id12">Template Function</a><a class="headerlink" href="#template-function" title="Permalink to this headline">¶</a></h3>
<p>Module scope:</p>
<div class="highlight-none"><div class="highlight"><pre>#template &lt;name&gt;[(parameters)]
#end template
</pre></div>
</div>
<p>Define a template function within the current module.  Anything between
<tt class="docutils literal"><span class="pre">#template</span></tt> and <tt class="docutils literal"><span class="pre">#end</span> <span class="pre">template</span></tt> are evaluated in function scope.</p>
<p>An optional list of identifiers can be provided as parameters.  Without the
parameter list, the template is considered to be a variable argument function.
The arguments will then be available as builtins <tt class="docutils literal"><span class="pre">_args</span></tt> and <tt class="docutils literal"><span class="pre">_kwargs</span></tt>.
<a class="reference internal" href="#template-execution"><em>More details</em></a>.</p>
<p>Example:</p>
<div class="highlight-none"><div class="highlight"><pre>#template join_tokens
joined: ${&quot;, &quot;.join(args)}
#end template

#template header(author, title)
$title by author $author
#end template
</pre></div>
</div>
</div>
<div class="section" id="single-statement">
<span id="single-exec-directive"></span><h3><a class="toc-backref" href="#id13">Single Statement</a><a class="headerlink" href="#single-statement" title="Permalink to this headline">¶</a></h3>
<p>Function scope:</p>
<div class="highlight-none"><div class="highlight"><pre>#! &lt;python_statement&gt;
</pre></div>
</div>
<p>The entire &lt;python_statement&gt; is copied over to the generated template function
code (with indentation stripped).  Write the statement as if it were inside a
normal Python function.</p>
<p>Example:</p>
<div class="highlight-none"><div class="highlight"><pre>#! temp = &quot;temporary value&quot;
#! break
#! continue
#! _output.write(another_template())
</pre></div>
</div>
<p>For builtin variables available to the execution statement, refer
<a class="reference internal" href="#template-execution"><em>here</em></a>.</p>
</div>
<div class="section" id="compound-statement">
<span id="compound-exec-directive"></span><h3><a class="toc-backref" href="#id14">Compound Statement</a><a class="headerlink" href="#compound-statement" title="Permalink to this headline">¶</a></h3>
<p>Function scope:</p>
<div class="highlight-none"><div class="highlight"><pre>#{ &lt;python_compound_statement&gt;
#}
</pre></div>
</div>
<p>Compound statements are useful for Python control logic such as <tt class="docutils literal"><span class="pre">if</span></tt>,
<tt class="docutils literal"><span class="pre">for</span></tt>, and <tt class="docutils literal"><span class="pre">while</span></tt>.  Text lines and other execution statements between
<tt class="docutils literal"><span class="pre">#{</span></tt> and <tt class="docutils literal"><span class="pre">#}</span></tt> are considered part of the compound block.</p>
<p>Example:</p>
<div class="highlight-none"><div class="highlight"><pre>#{ for i in range(0, 5):
line $i
#}

#{  if setting:
setting is true!
#}
#{  else:
setting is false!
#}
</pre></div>
</div>
</div>
</div>
<div class="section" id="text-line">
<h2><a class="toc-backref" href="#id15">Text Line</a><a class="headerlink" href="#text-line" title="Permalink to this headline">¶</a></h2>
<p>Text lines are appended to the evaluation output after placeholder
substitution is performed.  All placeholders begin with the placeholder
character (by default &#8216;$&#8217;).  Placeholders can be escaped by repeating the
character twice (&#8220;$$&#8221;).</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>Text lines are ignored at the module scope.  Take advantage of that to
&#8216;trick&#8217; editors into highlighting your template file correctly.</p>
<p>For example, consider this c++ template file, with &#8220;//#&#8221; as the directive
prefix, and &#8216;%&#8217; as the placeholder:</p>
<blockquote>
<div><div class="highlight-c"><div class="highlight"><pre><span class="kt">void</span> <span class="nf">initialize</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span> <span class="n">values</span><span class="p">)</span>
<span class="p">{</span>
<span class="c1">//# template set_values(count)</span>
<span class="c1">//#     {for i in (0, count):</span>
    <span class="n">values</span><span class="p">[</span><span class="o">%</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">%</span><span class="n">i</span>
<span class="c1">//#     }</span>
<span class="c1">//# end template</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p class="last">In the template above, only value assignment is part of the generated text.
The function signature and brackets are ignored, but they tell your editor
how to highlight the entire file, and give context to your template.</p>
</div>
<div class="section" id="identifier-placeholder">
<h3><a class="toc-backref" href="#id16">Identifier Placeholder</a><a class="headerlink" href="#identifier-placeholder" title="Permalink to this headline">¶</a></h3>
<div class="highlight-none"><div class="highlight"><pre>$&lt;identifier&gt;
</pre></div>
</div>
<p>For simple identifier substitution, just prepend the placeholder character to
the name.</p>
<p>Example:</p>
<div class="highlight-none"><div class="highlight"><pre>$author is responsible for this document
</pre></div>
</div>
</div>
<div class="section" id="expression-placeholder">
<h3><a class="toc-backref" href="#id17">Expression Placeholder</a><a class="headerlink" href="#expression-placeholder" title="Permalink to this headline">¶</a></h3>
<div class="highlight-none"><div class="highlight"><pre>${&lt;python_expression&gt;}
</pre></div>
</div>
<p>For complex substituion, surround a Python expression with brackets.
&lt;python_expression&gt; will be evaluated using Python <tt class="docutils literal"><span class="pre">eval</span></tt>, and the result
is used for the substitution.</p>
<p>&#8216;&#8217; can be used within the expression to escape the ending bracket &#8216;}&#8217;,</p>
<p>Example:</p>
<div class="highlight-none"><div class="highlight"><pre>the sum of the values is ${a + b}
lookup result: ${values[key]}
</pre></div>
</div>
</div>
<div class="section" id="slurp-placeholder">
<h3><a class="toc-backref" href="#id18">Slurp Placeholder</a><a class="headerlink" href="#slurp-placeholder" title="Permalink to this headline">¶</a></h3>
<div class="highlight-none"><div class="highlight"><pre>$&lt;
</pre></div>
</div>
<p>A special place holder, <tt class="docutils literal"><span class="pre">$&lt;</span></tt>, is used to slurp whatever text that comes
between it and the next line.  It&#8217;s useful for eating up extraneous newlines.</p>
<p>For instance:</p>
<div class="highlight-none"><div class="highlight"><pre>this is the end of the file
#end template
</pre></div>
</div>
<p>will generate a newline after &#8220;file&#8221; since it&#8217;s considered part of the
textline, whereas:</p>
<div class="highlight-none"><div class="highlight"><pre>this is the end of the file$&lt;
#end template
</pre></div>
</div>
<p>will ensure that no newline occurrs at the end of the output.</p>
</div>
</div>
<div class="section" id="template-execution">
<span id="id1"></span><h2><a class="toc-backref" href="#id19">Template Execution</a><a class="headerlink" href="#template-execution" title="Permalink to this headline">¶</a></h2>
<p>When a template function executes, it has a set of variables defined on entry.
Here they are in definition order:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="#import-directive"><em>python import</em></a> aliases</li>
<li><a class="reference internal" href="#load-directive"><em>template load</em></a> aliases</li>
<li>module <a class="reference internal" href="#attribute-directive"><em>attributes</em></a></li>
<li>other <a class="reference internal" href="#template-directive"><em>template function</em></a> names within the same module</li>
<li>parameters to the <a class="reference internal" href="#template-directive"><em>template function</em></a></li>
<li>builtin locals</li>
</ul>
</div></blockquote>
<dl class="docutils">
<dt>The builtin locals are:</dt>
<dd><ul class="first last simple">
<li><tt class="docutils literal"><span class="pre">_module</span></tt> - the module containing the executing function</li>
<li><tt class="docutils literal"><span class="pre">_output</span></tt> - an output stream that goes directly towards the generated
string.  Write anything you like to the stream and it&#8217;ll be added to the
function&#8217;s return.</li>
<li><tt class="docutils literal"><span class="pre">_args</span></tt> - positional arguments for variable argument functions. Use like Python *args.</li>
<li><tt class="docutils literal"><span class="pre">_kwargs</span></tt> - keyword arguments for variable argument functions. Use like Python **kwargs.</li>
<li><tt class="docutils literal"><span class="pre">_textdb</span></tt> - reserved for Texthon</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="template-modules">
<span id="id2"></span><h2><a class="toc-backref" href="#id20">Template Modules</a><a class="headerlink" href="#template-modules" title="Permalink to this headline">¶</a></h2>
<p>Template functions in the same file are grouped into a template module.  After
a <a class="reference internal" href="#load-directive"><em>load</em></a>, you can access a module&#8217;s functions through the
alias:</p>
<div class="highlight-none"><div class="highlight"><pre>#load &quot;lib/lib.tmpl&quot; as lib
${lib.template_func()}
</pre></div>
</div>
<p>All paths that resolve to the same file share the same module.  If you modify a
module attribute, it&#8217;ll affect all template code that has the same module
loaded.</p>
<p id="module-mixins">Modules can be combined to form new modules.  This usage is called mixins,
which is Texthon&#8217;s solution to template polymorphism:</p>
<div class="highlight-none"><div class="highlight"><pre>#load &quot;mod1.tmpl&quot; as mod1
#load &quot;mod2.tmpl&quot; as mod2
#load &quot;mod2.tmpl&quot; as mod3
#!new_module = mod1(mod2, mod3)
${new_module.attr}
</pre></div>
</div>
<p>The example above creates a new module that contains all definitions and
aliases within <tt class="docutils literal"><span class="pre">mod1</span></tt>, <tt class="docutils literal"><span class="pre">mod2</span></tt>, and <tt class="docutils literal"><span class="pre">mod3</span></tt>.  <tt class="docutils literal"><span class="pre">new_module</span></tt> is formed by
first cloning <tt class="docutils literal"><span class="pre">mod1</span></tt> with a shallow copy, and then inserting <tt class="docutils literal"><span class="pre">mod2</span></tt> and
<tt class="docutils literal"><span class="pre">mod3</span></tt> as mixins. The final lookup for &#8220;attr&#8221; is valid as long as &#8220;attr&#8221; is
available in any of the three modules.</p>
<p>See the <a class="reference internal" href="#test-samples"><em>html sample</em></a> for example usage.</p>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        «&#160;&#160;<a href="index.html">Introduction</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="api.html">Python API</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2013, Kevin Lin.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>